import { readFileSync } from "node:fs";
import { join } from "node:path";
import { fileURLToPath } from "node:url";
import { dirname } from "node:path";

const __dirname = dirname(fileURLToPath(import.meta.url));
const CONFIG_PATH = join(__dirname, "..", ".ytdlrc");

export const SUBTITLE_DEFAULTS = {
  ja: "ja,ja-orig",
  en: "en",
  "zh-Hans": "zh-Hans,zh-Hant,zh",
  es: "es",
  hi: "hi",
  pt: "pt,pt-BR",
  id: "id",
};

const messages = {
  ja: {
    // check-deps
    missingDeps: "依存ツールが見つかりません:",
    installPrompt: "自動でインストールしますか？",
    installOption: "インストールする",
    installOptionDesc: "brew install で自動インストール",
    skipOption: "スキップ",
    skipOptionDesc: "手動でインストールする",
    installing: "をインストール中...",
    installSuccess: "のインストール完了",
    installFail: "インストールに失敗しました。手動でインストールしてください:",
    brewNotFound: "brew が見つかりません。以下を手動でインストールしてください:",
    // interactive
    urlMessage: "URL",
    urlPlaceholder: "https://youtu.be/xxxxx",
    urlRequired: "URL を入力してください。",
    urlInvalidProtocol: "有効な HTTP/HTTPS URL を入力してください。",
    urlInvalid: "有効な URL を入力してください。",
    modeMessage: "何をダウンロードしますか？",
    modeVideo: "動画",
    modeVideoHint: "最高画質, mp4",
    modeAudio: "音声のみ",
    modeAudioHint: "m4a",
    modeInfo: "情報のみ表示",
    modeInfoHint: "ダウンロードしない",
    qualityMessage: "画質",
    qualityBest: "最高画質",
    qualityBestHint: "おすすめ",
    playlistConfirm: "プレイリストのようです。全動画をダウンロードしますか？",
    saveTo: "保存先",
    summaryUrl: "URL",
    summaryMode: "モード",
    summaryAudio: "音声 (m4a)",
    summaryVideo: "動画",
    summarySaveTo: "保存先",
    summaryPlaylist: "プレイリスト",
    summaryYes: "はい",
    summaryTitle: "確認",
    startDownload: "ダウンロードを開始しますか？",
    cancelled: "キャンセルしました。",
    done: "完了",
    exitedWithCode: "終了コード:",
    // pre-download info
    fetchingInfo: "動画情報を取得中...",
    fetchInfoFailed: "動画情報の取得に失敗しました。URLを確認してください。",
    confirmDownload: "この動画をダウンロードしますか？",
    // error recovery
    downloadFailed: "ダウンロードに失敗しました",
    retryWithCookie: "クッキー付きでリトライ",
    retryWithCookieDesc: "ブラウザのクッキーを使って再試行（macOSキーチェーンへのアクセス許可が必要）",
    showDetails: "詳細を見る",
    showDetailsDesc: "エラーの詳細を表示",
    abort: "中止",
    abortDesc: "ダウンロードを中止する",
    retrying: "クッキー付きでリトライ中...",
    // advanced settings
    advancedSettings: "より詳細な設定",
    advancedSettingsHint: "字幕言語などを変更",
    subLangsMessage: "字幕言語",
    subLangsDefault: "デフォルト（言語設定に従う）",
    subLangsDefaultHint: "日本語なら ja, 英語なら en",
    subLangsJaEn: "日本語 + 英語",
    subLangsAll: "全言語",
    subLangsCustom: "カスタム",
    subLangsCustomHint: "カンマ区切りで入力（例: ja,en,ko）",
    subLangsCustomMessage: "字幕言語コード（カンマ区切り）",
    subLangsCustomPlaceholder: "ja,en,ko",
    subLangsCustomRequired: "言語コードを入力してください",
    advancedDone: "設定完了",
  },
  en: {
    // check-deps
    missingDeps: "Missing dependencies:",
    installPrompt: "Install automatically?",
    installOption: "Install",
    installOptionDesc: "Auto-install via brew",
    skipOption: "Skip",
    skipOptionDesc: "Install manually",
    installing: "Installing",
    installSuccess: "installed successfully",
    installFail: "Installation failed. Please install manually:",
    brewNotFound: "brew not found. Please install manually:",
    // interactive
    urlMessage: "URL",
    urlPlaceholder: "https://youtu.be/xxxxx",
    urlRequired: "URL is required.",
    urlInvalidProtocol: "Enter a valid HTTP/HTTPS URL.",
    urlInvalid: "Enter a valid URL.",
    modeMessage: "What to download?",
    modeVideo: "Video",
    modeVideoHint: "best quality, mp4",
    modeAudio: "Audio only",
    modeAudioHint: "m4a",
    modeInfo: "Show info only",
    modeInfoHint: "no download",
    qualityMessage: "Quality",
    qualityBest: "Best available",
    qualityBestHint: "recommended",
    playlistConfirm: "This looks like a playlist. Download all videos?",
    saveTo: "Save to",
    summaryUrl: "URL",
    summaryMode: "Mode",
    summaryAudio: "audio (m4a)",
    summaryVideo: "video",
    summarySaveTo: "Save to",
    summaryPlaylist: "Playlist",
    summaryYes: "yes",
    summaryTitle: "Summary",
    startDownload: "Start download?",
    cancelled: "cancelled.",
    done: "done.",
    exitedWithCode: "exited with code",
    // pre-download info
    fetchingInfo: "Fetching video info...",
    fetchInfoFailed: "Failed to fetch video info. Please check the URL.",
    confirmDownload: "Download this video?",
    // error recovery
    downloadFailed: "Download failed",
    retryWithCookie: "Retry with cookies",
    retryWithCookieDesc: "Retry using browser cookies (macOS Keychain access will be requested)",
    showDetails: "Show details",
    showDetailsDesc: "Show error details",
    abort: "Abort",
    abortDesc: "Cancel the download",
    retrying: "Retrying with cookies...",
    // advanced settings
    advancedSettings: "Advanced settings",
    advancedSettingsHint: "Change subtitle languages, etc.",
    subLangsMessage: "Subtitle languages",
    subLangsDefault: "Default (follow language setting)",
    subLangsDefaultHint: "ja for Japanese, en for English",
    subLangsJaEn: "English + Japanese",
    subLangsAll: "All languages",
    subLangsCustom: "Custom",
    subLangsCustomHint: "Enter comma-separated codes (e.g. ja,en,ko)",
    subLangsCustomMessage: "Subtitle language codes (comma-separated)",
    subLangsCustomPlaceholder: "ja,en,ko",
    subLangsCustomRequired: "Enter language codes.",
    advancedDone: "Settings saved",
  },
  "zh-Hans": {
    // check-deps
    missingDeps: "缺少依赖工具：",
    installPrompt: "是否自动安装？",
    installOption: "安装",
    installOptionDesc: "通过 brew install 自动安装",
    skipOption: "跳过",
    skipOptionDesc: "手动安装",
    installing: "正在安装...",
    installSuccess: "安装完成",
    installFail: "安装失败。请手动安装：",
    brewNotFound: "未找到 brew。请手动安装以下工具：",
    // interactive
    urlMessage: "URL",
    urlPlaceholder: "https://youtu.be/xxxxx",
    urlRequired: "请输入 URL。",
    urlInvalidProtocol: "请输入有效的 HTTP/HTTPS URL。",
    urlInvalid: "请输入有效的 URL。",
    modeMessage: "要下载什么？",
    modeVideo: "视频",
    modeVideoHint: "最高画质, mp4",
    modeAudio: "仅音频",
    modeAudioHint: "m4a",
    modeInfo: "仅显示信息",
    modeInfoHint: "不下载",
    qualityMessage: "画质",
    qualityBest: "最高画质",
    qualityBestHint: "推荐",
    playlistConfirm: "这似乎是播放列表。要下载所有视频吗？",
    saveTo: "保存到",
    summaryUrl: "URL",
    summaryMode: "模式",
    summaryAudio: "音频 (m4a)",
    summaryVideo: "视频",
    summarySaveTo: "保存到",
    summaryPlaylist: "播放列表",
    summaryYes: "是",
    summaryTitle: "确认",
    startDownload: "开始下载？",
    cancelled: "已取消。",
    done: "完成",
    exitedWithCode: "退出代码：",
    // pre-download info
    fetchingInfo: "正在获取视频信息...",
    fetchInfoFailed: "获取视频信息失败。请检查 URL。",
    confirmDownload: "要下载此视频吗？",
    // error recovery
    downloadFailed: "下载失败",
    retryWithCookie: "使用 Cookie 重试",
    retryWithCookieDesc: "使用浏览器 Cookie 重试（需要 macOS 钥匙串访问权限）",
    showDetails: "查看详情",
    showDetailsDesc: "显示错误详情",
    abort: "中止",
    abortDesc: "中止下载",
    retrying: "正在使用 Cookie 重试...",
    // advanced settings
    advancedSettings: "更多设置",
    advancedSettingsHint: "更改字幕语言等",
    subLangsMessage: "字幕语言",
    subLangsDefault: "默认（跟随语言设置）",
    subLangsDefaultHint: "中文为 zh-Hans，英语为 en",
    subLangsJaEn: "中文 + 英语",
    subLangsAll: "全部语言",
    subLangsCustom: "自定义",
    subLangsCustomHint: "逗号分隔输入（例：zh-Hans,en,ja）",
    subLangsCustomMessage: "字幕语言代码（逗号分隔）",
    subLangsCustomPlaceholder: "zh-Hans,en,ja",
    subLangsCustomRequired: "请输入语言代码",
    advancedDone: "设置完成",
  },
  es: {
    // check-deps
    missingDeps: "Faltan dependencias:",
    installPrompt: "¿Instalar automáticamente?",
    installOption: "Instalar",
    installOptionDesc: "Instalar automáticamente con brew",
    skipOption: "Omitir",
    skipOptionDesc: "Instalar manualmente",
    installing: "Instalando...",
    installSuccess: "instalado correctamente",
    installFail: "Error en la instalación. Instale manualmente:",
    brewNotFound: "brew no encontrado. Instale manualmente:",
    // interactive
    urlMessage: "URL",
    urlPlaceholder: "https://youtu.be/xxxxx",
    urlRequired: "Se requiere una URL.",
    urlInvalidProtocol: "Ingrese una URL HTTP/HTTPS válida.",
    urlInvalid: "Ingrese una URL válida.",
    modeMessage: "¿Qué descargar?",
    modeVideo: "Video",
    modeVideoHint: "mejor calidad, mp4",
    modeAudio: "Solo audio",
    modeAudioHint: "m4a",
    modeInfo: "Solo información",
    modeInfoHint: "sin descarga",
    qualityMessage: "Calidad",
    qualityBest: "Mejor disponible",
    qualityBestHint: "recomendado",
    playlistConfirm: "Parece una lista de reproducción. ¿Descargar todos los videos?",
    saveTo: "Guardar en",
    summaryUrl: "URL",
    summaryMode: "Modo",
    summaryAudio: "audio (m4a)",
    summaryVideo: "video",
    summarySaveTo: "Guardar en",
    summaryPlaylist: "Lista de reproducción",
    summaryYes: "sí",
    summaryTitle: "Resumen",
    startDownload: "¿Iniciar descarga?",
    cancelled: "cancelado.",
    done: "completado.",
    exitedWithCode: "código de salida:",
    // pre-download info
    fetchingInfo: "Obteniendo información del video...",
    fetchInfoFailed: "Error al obtener información. Verifique la URL.",
    confirmDownload: "¿Descargar este video?",
    // error recovery
    downloadFailed: "Descarga fallida",
    retryWithCookie: "Reintentar con cookies",
    retryWithCookieDesc: "Reintentar usando cookies del navegador (se solicitará acceso al llavero de macOS)",
    showDetails: "Ver detalles",
    showDetailsDesc: "Mostrar detalles del error",
    abort: "Cancelar",
    abortDesc: "Cancelar la descarga",
    retrying: "Reintentando con cookies...",
    // advanced settings
    advancedSettings: "Configuración avanzada",
    advancedSettingsHint: "Cambiar idiomas de subtítulos, etc.",
    subLangsMessage: "Idiomas de subtítulos",
    subLangsDefault: "Predeterminado (según idioma)",
    subLangsDefaultHint: "es para español, en para inglés",
    subLangsJaEn: "Español + Inglés",
    subLangsAll: "Todos los idiomas",
    subLangsCustom: "Personalizado",
    subLangsCustomHint: "Separados por comas (ej: es,en,ja)",
    subLangsCustomMessage: "Códigos de idioma de subtítulos (separados por comas)",
    subLangsCustomPlaceholder: "es,en,ja",
    subLangsCustomRequired: "Ingrese los códigos de idioma.",
    advancedDone: "Configuración guardada",
  },
  hi: {
    // check-deps
    missingDeps: "आवश्यक टूल नहीं मिले:",
    installPrompt: "स्वचालित रूप से इंस्टॉल करें?",
    installOption: "इंस्टॉल करें",
    installOptionDesc: "brew install से स्वचालित इंस्टॉल",
    skipOption: "छोड़ें",
    skipOptionDesc: "मैन्युअल रूप से इंस्टॉल करें",
    installing: "इंस्टॉल हो रहा है...",
    installSuccess: "इंस्टॉल सफल",
    installFail: "इंस्टॉल विफल। कृपया मैन्युअल रूप से इंस्टॉल करें:",
    brewNotFound: "brew नहीं मिला। कृपया मैन्युअल रूप से इंस्टॉल करें:",
    // interactive
    urlMessage: "URL",
    urlPlaceholder: "https://youtu.be/xxxxx",
    urlRequired: "URL आवश्यक है।",
    urlInvalidProtocol: "कृपया मान्य HTTP/HTTPS URL दर्ज करें।",
    urlInvalid: "कृपया मान्य URL दर्ज करें।",
    modeMessage: "क्या डाउनलोड करना है?",
    modeVideo: "वीडियो",
    modeVideoHint: "सर्वश्रेष्ठ गुणवत्ता, mp4",
    modeAudio: "केवल ऑडियो",
    modeAudioHint: "m4a",
    modeInfo: "केवल जानकारी दिखाएँ",
    modeInfoHint: "डाउनलोड नहीं",
    qualityMessage: "गुणवत्ता",
    qualityBest: "सर्वश्रेष्ठ उपलब्ध",
    qualityBestHint: "अनुशंसित",
    playlistConfirm: "यह प्लेलिस्ट लगती है। सभी वीडियो डाउनलोड करें?",
    saveTo: "यहाँ सेव करें",
    summaryUrl: "URL",
    summaryMode: "मोड",
    summaryAudio: "ऑडियो (m4a)",
    summaryVideo: "वीडियो",
    summarySaveTo: "यहाँ सेव करें",
    summaryPlaylist: "प्लेलिस्ट",
    summaryYes: "हाँ",
    summaryTitle: "सारांश",
    startDownload: "डाउनलोड शुरू करें?",
    cancelled: "रद्द किया गया।",
    done: "पूर्ण",
    exitedWithCode: "एग्ज़िट कोड:",
    // pre-download info
    fetchingInfo: "वीडियो जानकारी प्राप्त हो रही है...",
    fetchInfoFailed: "वीडियो जानकारी प्राप्त करने में विफल। कृपया URL जाँचें।",
    confirmDownload: "यह वीडियो डाउनलोड करें?",
    // error recovery
    downloadFailed: "डाउनलोड विफल",
    retryWithCookie: "कुकी के साथ पुनः प्रयास",
    retryWithCookieDesc: "ब्राउज़र कुकी से पुनः प्रयास (macOS कीचेन एक्सेस आवश्यक)",
    showDetails: "विवरण देखें",
    showDetailsDesc: "त्रुटि विवरण दिखाएँ",
    abort: "रद्द करें",
    abortDesc: "डाउनलोड रद्द करें",
    retrying: "कुकी के साथ पुनः प्रयास हो रहा है...",
    // advanced settings
    advancedSettings: "उन्नत सेटिंग्स",
    advancedSettingsHint: "उपशीर्षक भाषाएँ आदि बदलें",
    subLangsMessage: "उपशीर्षक भाषाएँ",
    subLangsDefault: "डिफ़ॉल्ट (भाषा सेटिंग के अनुसार)",
    subLangsDefaultHint: "हिंदी के लिए hi, अंग्रेज़ी के लिए en",
    subLangsJaEn: "हिंदी + अंग्रेज़ी",
    subLangsAll: "सभी भाषाएँ",
    subLangsCustom: "कस्टम",
    subLangsCustomHint: "कॉमा से अलग करें (उदा: hi,en,ja)",
    subLangsCustomMessage: "उपशीर्षक भाषा कोड (कॉमा से अलग)",
    subLangsCustomPlaceholder: "hi,en,ja",
    subLangsCustomRequired: "कृपया भाषा कोड दर्ज करें",
    advancedDone: "सेटिंग्स सेव हो गईं",
  },
  pt: {
    // check-deps
    missingDeps: "Dependências ausentes:",
    installPrompt: "Instalar automaticamente?",
    installOption: "Instalar",
    installOptionDesc: "Instalar automaticamente via brew",
    skipOption: "Pular",
    skipOptionDesc: "Instalar manualmente",
    installing: "Instalando...",
    installSuccess: "instalado com sucesso",
    installFail: "Falha na instalação. Instale manualmente:",
    brewNotFound: "brew não encontrado. Instale manualmente:",
    // interactive
    urlMessage: "URL",
    urlPlaceholder: "https://youtu.be/xxxxx",
    urlRequired: "URL é obrigatória.",
    urlInvalidProtocol: "Insira uma URL HTTP/HTTPS válida.",
    urlInvalid: "Insira uma URL válida.",
    modeMessage: "O que baixar?",
    modeVideo: "Vídeo",
    modeVideoHint: "melhor qualidade, mp4",
    modeAudio: "Somente áudio",
    modeAudioHint: "m4a",
    modeInfo: "Apenas informações",
    modeInfoHint: "sem download",
    qualityMessage: "Qualidade",
    qualityBest: "Melhor disponível",
    qualityBestHint: "recomendado",
    playlistConfirm: "Parece uma playlist. Baixar todos os vídeos?",
    saveTo: "Salvar em",
    summaryUrl: "URL",
    summaryMode: "Modo",
    summaryAudio: "áudio (m4a)",
    summaryVideo: "vídeo",
    summarySaveTo: "Salvar em",
    summaryPlaylist: "Playlist",
    summaryYes: "sim",
    summaryTitle: "Resumo",
    startDownload: "Iniciar download?",
    cancelled: "cancelado.",
    done: "concluído.",
    exitedWithCode: "código de saída:",
    // pre-download info
    fetchingInfo: "Obtendo informações do vídeo...",
    fetchInfoFailed: "Falha ao obter informações. Verifique a URL.",
    confirmDownload: "Baixar este vídeo?",
    // error recovery
    downloadFailed: "Download falhou",
    retryWithCookie: "Tentar novamente com cookies",
    retryWithCookieDesc: "Tentar novamente usando cookies do navegador (acesso ao Chaves do macOS será solicitado)",
    showDetails: "Ver detalhes",
    showDetailsDesc: "Mostrar detalhes do erro",
    abort: "Cancelar",
    abortDesc: "Cancelar o download",
    retrying: "Tentando novamente com cookies...",
    // advanced settings
    advancedSettings: "Configurações avançadas",
    advancedSettingsHint: "Alterar idiomas de legendas, etc.",
    subLangsMessage: "Idiomas de legendas",
    subLangsDefault: "Padrão (conforme idioma)",
    subLangsDefaultHint: "pt para português, en para inglês",
    subLangsJaEn: "Português + Inglês",
    subLangsAll: "Todos os idiomas",
    subLangsCustom: "Personalizado",
    subLangsCustomHint: "Separados por vírgula (ex: pt,en,ja)",
    subLangsCustomMessage: "Códigos de idioma de legendas (separados por vírgula)",
    subLangsCustomPlaceholder: "pt,en,ja",
    subLangsCustomRequired: "Insira os códigos de idioma.",
    advancedDone: "Configurações salvas",
  },
  id: {
    // check-deps
    missingDeps: "Dependensi tidak ditemukan:",
    installPrompt: "Instal otomatis?",
    installOption: "Instal",
    installOptionDesc: "Instal otomatis via brew",
    skipOption: "Lewati",
    skipOptionDesc: "Instal manual",
    installing: "Menginstal...",
    installSuccess: "berhasil diinstal",
    installFail: "Instalasi gagal. Silakan instal manual:",
    brewNotFound: "brew tidak ditemukan. Silakan instal manual:",
    // interactive
    urlMessage: "URL",
    urlPlaceholder: "https://youtu.be/xxxxx",
    urlRequired: "URL wajib diisi.",
    urlInvalidProtocol: "Masukkan URL HTTP/HTTPS yang valid.",
    urlInvalid: "Masukkan URL yang valid.",
    modeMessage: "Apa yang ingin diunduh?",
    modeVideo: "Video",
    modeVideoHint: "kualitas terbaik, mp4",
    modeAudio: "Audio saja",
    modeAudioHint: "m4a",
    modeInfo: "Tampilkan info saja",
    modeInfoHint: "tanpa unduhan",
    qualityMessage: "Kualitas",
    qualityBest: "Terbaik tersedia",
    qualityBestHint: "disarankan",
    playlistConfirm: "Ini sepertinya playlist. Unduh semua video?",
    saveTo: "Simpan ke",
    summaryUrl: "URL",
    summaryMode: "Mode",
    summaryAudio: "audio (m4a)",
    summaryVideo: "video",
    summarySaveTo: "Simpan ke",
    summaryPlaylist: "Playlist",
    summaryYes: "ya",
    summaryTitle: "Ringkasan",
    startDownload: "Mulai unduh?",
    cancelled: "dibatalkan.",
    done: "selesai.",
    exitedWithCode: "kode keluar:",
    // pre-download info
    fetchingInfo: "Mengambil info video...",
    fetchInfoFailed: "Gagal mengambil info video. Periksa URL.",
    confirmDownload: "Unduh video ini?",
    // error recovery
    downloadFailed: "Unduhan gagal",
    retryWithCookie: "Coba lagi dengan cookie",
    retryWithCookieDesc: "Coba lagi menggunakan cookie browser (akses Keychain macOS diperlukan)",
    showDetails: "Lihat detail",
    showDetailsDesc: "Tampilkan detail error",
    abort: "Batalkan",
    abortDesc: "Batalkan unduhan",
    retrying: "Mencoba lagi dengan cookie...",
    // advanced settings
    advancedSettings: "Pengaturan lanjutan",
    advancedSettingsHint: "Ubah bahasa subtitle, dll.",
    subLangsMessage: "Bahasa subtitle",
    subLangsDefault: "Default (ikuti pengaturan bahasa)",
    subLangsDefaultHint: "id untuk Indonesia, en untuk Inggris",
    subLangsJaEn: "Indonesia + Inggris",
    subLangsAll: "Semua bahasa",
    subLangsCustom: "Kustom",
    subLangsCustomHint: "Pisahkan dengan koma (contoh: id,en,ja)",
    subLangsCustomMessage: "Kode bahasa subtitle (pisahkan dengan koma)",
    subLangsCustomPlaceholder: "id,en,ja",
    subLangsCustomRequired: "Masukkan kode bahasa.",
    advancedDone: "Pengaturan tersimpan",
  },
};

const SUPPORTED_LANGS = ["ja", "en", "zh-Hans", "es", "hi", "pt", "id"];

function detectLang() {
  // 1. CLI arg: --lang en
  const idx = process.argv.indexOf("--lang");
  if (idx !== -1 && process.argv[idx + 1]) {
    const lang = process.argv[idx + 1];
    if (!SUPPORTED_LANGS.includes(lang)) {
      console.error(`Error: Unsupported language '${lang}'. Supported: ${SUPPORTED_LANGS.join(", ")}`);
      console.error(`Use --lang <code> (${SUPPORTED_LANGS.join(", ")}), or set YTDL_LANG environment variable.`);
      process.exit(1);
    }
    return lang;
  }
  // 2. Environment variable: YTDL_LANG=en
  if (process.env.YTDL_LANG) {
    const lang = process.env.YTDL_LANG;
    if (!SUPPORTED_LANGS.includes(lang)) {
      console.error(`Error: Unsupported language '${lang}'. Supported: ${SUPPORTED_LANGS.join(", ")}`);
      console.error(`Use --lang <code> (${SUPPORTED_LANGS.join(", ")}), or set YTDL_LANG environment variable.`);
      process.exit(1);
    }
    return lang;
  }
  // 3. Config file: .ytdlrc
  try {
    const content = readFileSync(CONFIG_PATH, "utf-8").trim();
    const match = content.match(/^lang\s*=\s*([\w-]+)/m);
    if (match) {
      const lang = match[1];
      if (!SUPPORTED_LANGS.includes(lang)) {
        console.error(`Error: Unsupported language '${lang}'. Supported: ${SUPPORTED_LANGS.join(", ")}`);
        console.error(`Use --lang <code> (${SUPPORTED_LANGS.join(", ")}), or set YTDL_LANG environment variable.`);
        process.exit(1);
      }
      return lang;
    }
  } catch {
    // no config file
  }
  // 4. Default: ja
  return "ja";
}

const lang = detectLang();
export const t = messages[lang] || messages.ja;
export const currentLang = lang;
